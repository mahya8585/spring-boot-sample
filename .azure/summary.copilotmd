# TechBookStore Azure Infrastructure - Provision-Only Deployment Summary

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:** TechBookStore  
**ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¿ã‚¤ãƒ—:** Provision-Only (ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ã¿)  
**IaC ãƒ„ãƒ¼ãƒ«:** Azure CLI + Bicep  
**ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹:** Azure Container Apps  
**ç”Ÿæˆæ—¥:** 2026å¹´2æœˆ9æ—¥

## ğŸ“Š ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### Infrastructure as Code (IaC) ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ã‚µã‚¤ã‚º |
|---------|------------|------|--------|
| main.bicep | `infra/main.bicep` | ãƒ¡ã‚¤ãƒ³ Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | ~650 è¡Œ |
| main.parameters.json | `infra/main.parameters.json` | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« | ~20 è¡Œ |

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ã‚µã‚¤ã‚º |
|---------|------------|------|--------|
| deploy.ps1 | `infra/deploy.ps1` | ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ~380 è¡Œ |
| post-provision.ps1 | `infra/post-provision.ps1` | ãƒã‚¹ãƒˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ~430 è¡Œ |

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|---------|------------|------|
| README.md | `infra/README.md` | è©³ç´°ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰ |
| QUICKSTART.md | `infra/QUICKSTART.md` | ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰ |
| compliance-report.md | `infra/compliance-report.md` | IaC ãƒ«ãƒ¼ãƒ«ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ |
| plan.copilotmd | `.azure/plan.copilotmd` | ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ—ãƒ©ãƒ³ |
| summary.copilotmd | `.azure/summary.copilotmd` | ã“ã®ã‚µãƒãƒªãƒ¼ |

## ğŸ—ï¸ ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹

### ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | æ•°é‡ | SKU/æ§‹æˆ | ç›®çš„ |
|-------------|-----|----------|------|
| Container Apps Environment | 1 | Consumption | Container Apps ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç’°å¢ƒ |
| Container App (Backend) | 1 | Consumption, 1-3 replicas | Spring Boot 3.5.0 (Java 21) ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ |
| Container App (Frontend) | 1 | Consumption, 1-2 replicas | React 16 + Nginx ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ |
| Container Registry | 1 | Basic | ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |

### ãƒ‡ãƒ¼ã‚¿ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | æ•°é‡ | SKU/æ§‹æˆ | ç›®çš„ |
|-------------|-----|----------|------|
| PostgreSQL Flexible Server | 1 | GeneralPurpose Standard_D2ds_v5 (2 vCore, 8GB RAM) | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| Azure Cache for Redis | 1 | Basic C0 (250MB) | ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | æ•°é‡ | æ§‹æˆ | ç›®çš„ |
|-------------|-----|------|------|
| Key Vault | 1 | Standard, RBAC æœ‰åŠ¹ | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã‚­ãƒ¼ã®ç®¡ç† |
| User-Assigned Managed Identity | 1 | N/A | Container Apps ã®èªè¨¼ |
| System-Assigned Managed Identity | 1 | N/A | Backend Container App ã®èªè¨¼ |

### ç›£è¦–ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | æ•°é‡ | æ§‹æˆ | ç›®çš„ |
|-------------|-----|------|------|
| Application Insights | 1 | N/A | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–ã¨è¨ºæ–­ |
| Log Analytics Workspace | 1 | Pay-as-you-go | ãƒ­ã‚°é›†ç´„ã¨åˆ†æ |

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | æ•°é‡ | æ§‹æˆ | ç›®çš„ |
|-------------|-----|------|------|
| PostgreSQL Firewall Rules | 1 | Azure Services è¨±å¯ | ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ |

## ğŸ“ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Azure Subscription                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Resource Group: rg-techbookstore-prod         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚      Container Apps Environment (azcae{token})      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Backend         â”‚  â”‚  Frontend        â”‚        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Container App   â”‚â—„â”€â”¤  Container App   â”‚        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  (Spring Boot)   â”‚  â”‚  (React + Nginx) â”‚        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚              â”‚                                              â”‚  â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚  â”‚
â”‚  â”‚      â”‚  User-Assigned â”‚                                    â”‚  â”‚
â”‚  â”‚      â”‚  Managed ID    â”‚                                    â”‚  â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  â”‚
â”‚  â”‚              â”‚                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚           Dependency Resources                      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  PostgreSQL  â”‚  â”‚  Redis Cache â”‚               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  (17)        â”‚  â”‚  (Basic C0)  â”‚               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Key Vault   â”‚  â”‚  App Insightsâ”‚               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  (RBAC)      â”‚  â”‚  + Log Ana.  â”‚               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Container   â”‚                                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Registry    â”‚                                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ§‹æˆ

### èªè¨¼ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èªè¨¼æ–¹å¼ | è©³ç´° |
|-------------|----------|------|
| Container Apps â†’ Container Registry | User-Assigned Managed Identity | AcrPull ãƒ­ãƒ¼ãƒ« |
| Backend App â†’ PostgreSQL | System-Assigned Managed Identity | Service Connector çµŒç”± |
| Backend App â†’ Redis | System-Assigned Managed Identity | Service Connector çµŒç”± |
| Backend App â†’ Key Vault | System-Assigned Managed Identity | Key Vault Secrets User ãƒ­ãƒ¼ãƒ« |
| Backend App â†’ App Insights | Instrumentation Key | ç’°å¢ƒå¤‰æ•°çµŒç”± |

### ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦

| ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ« | ãƒ­ãƒ¼ãƒ« | ã‚¹ã‚³ãƒ¼ãƒ— | ç›®çš„ |
|------------|------|----------|------|
| User-Assigned MI | AcrPull (7f951dda-4ed3-4680-a7ca-43fe172d538d) | Container Registry | ã‚¤ãƒ¡ãƒ¼ã‚¸å–å¾— |
| User-Assigned MI | Key Vault Secrets Officer (b86a8fe4-44ce-4948-aee5-eccb2c155cd7) | Key Vault | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç† |
| User-Assigned MI | Key Vault Secrets User (4633458b-17de-408a-b874-0445c86b69e6) | Key Vault | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆèª­ã¿å–ã‚Š |

### Key Vault ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå | ç”¨é€” | å‚ç…§å…ƒ |
|-------------|------|--------|
| postgresql-connection-string | PostgreSQL JDBC æ¥ç¶šæ–‡å­—åˆ— | Backend Container App |
| postgresql-username | PostgreSQL ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å | Backend Container App |
| postgresql-password | PostgreSQL ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | Backend Container App |
| redis-connection-string | Redis æ¥ç¶šæ–‡å­—åˆ— | Backend Container App |
| redis-host | Redis ãƒ›ã‚¹ãƒˆå | Backend Container App |
| redis-key | Redis ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ | Backend Container App |

## ğŸ“ ç’°å¢ƒå¤‰æ•°æ§‹æˆ

### Backend Container App

| ç’°å¢ƒå¤‰æ•° | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|---------|--------|------|
| SPRING_PROFILES_ACTIVE | ç›´æ¥è¨­å®š | 'prod' |
| AZURE_KEYVAULT_ENDPOINT | Key Vault URI | ãƒãƒãƒ¼ã‚¸ãƒ‰ ID ã§æ¥ç¶š |
| APPLICATIONINSIGHTS_INSTRUMENTATION_KEY | App Insights ã‚­ãƒ¼ | ç›£è¦–ç”¨ |
| SPRING_DATASOURCE_URL | Secret (åˆæœŸ) / Service Connector (å¾Œ) | PostgreSQL æ¥ç¶š |
| SPRING_DATASOURCE_USERNAME | Secret (åˆæœŸ) / Service Connector (å¾Œ) | PostgreSQL ãƒ¦ãƒ¼ã‚¶ãƒ¼ |
| SPRING_DATASOURCE_PASSWORD | Secret (åˆæœŸ) / Service Connector (å¾Œ) | PostgreSQL ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| SPRING_DATA_REDIS_HOST | Secret | Redis ãƒ›ã‚¹ãƒˆ |
| SPRING_DATA_REDIS_PASSWORD | Secret | Redis ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| SPRING_DATA_REDIS_PORT | ç›´æ¥è¨­å®š | '6380' |
| SPRING_DATA_REDIS_SSL_ENABLED | ç›´æ¥è¨­å®š | 'true' |

**æ³¨:** Service Connector è¨­å®šå¾Œã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ã®ç’°å¢ƒå¤‰æ•°ã¯è‡ªå‹•çš„ã«ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚

### Frontend Container App

| ç’°å¢ƒå¤‰æ•° | ã‚½ãƒ¼ã‚¹ | èª¬æ˜ |
|---------|--------|------|
| REACT_APP_API_URL | Backend Container App FQDN | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹é †

### 1. å‰ææ¡ä»¶ã®ç¢ºèª
- [x] Azure CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (`az --version`)
- [x] Azure ãƒ­ã‚°ã‚¤ãƒ³ (`az login`)
- [x] Service Connector æ‹¡å¼µæ©Ÿèƒ½ (`az extension add --name serviceconnector-passwordless`)

### 2. ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°

```powershell
# ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
az group create --name rg-techbookstore-prod --location eastus2

# Bicep ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
az deployment group create `
  --resource-group rg-techbookstore-prod `
  --template-file infra/main.bicep `
  --parameters infra/main.parameters.json `
  --parameters `
    environmentName="techbookstore-prod" `
    location="eastus2" `
    postgresqlAdminUsername="<username>" `
    postgresqlAdminPassword="<password>" `
    postgresqlDatabaseName="techbookstore"
```

**æ‰€è¦æ™‚é–“:** 15-20 åˆ†

### 3. ãƒã‚¹ãƒˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°è¨­å®š

```powershell
# PostgreSQL Service Connector
az containerapp connection create postgres-flexible `
  --connection postgres-connection `
  --source-id <container-app-id> `
  --target-id <postgresql-id> `
  --database techbookstore `
  --system-identity `
  --client-type springBoot `
  -y

# Redis Service Connector
az containerapp connection create redis `
  --connection redis-connection `
  --source-id <container-app-id> `
  --target-id <redis-id> `
  --system-identity `
  --client-type springBoot `
  -y
```

**æ‰€è¦æ™‚é–“:** 2-3 åˆ†

### 4. æ¥ç¶šã®æ¤œè¨¼

```powershell
# ã™ã¹ã¦ã®æ¥ç¶šã‚’ãƒªã‚¹ãƒˆ
az containerapp connection list `
  --resource-group rg-techbookstore-prod `
  --name <backend-app-name> `
  --output table
```

## ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå‡ºåŠ›

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€ä»¥ä¸‹ã®æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™:

### ãƒªã‚½ãƒ¼ã‚¹è­˜åˆ¥å­

```json
{
  "AZURE_SUBSCRIPTION_ID": "70bcc220-4d88-48f2-a59a-77bae4785eac",
  "AZURE_RESOURCE_GROUP": "rg-techbookstore-prod",
  "AZURE_LOCATION": "eastus2",
  "AZURE_TENANT_ID": "<tenant-id>"
}
```

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```json
{
  "BACKEND_APP_URL": "https://azcaback{token}.{region}.azurecontainerapps.io",
  "FRONTEND_APP_URL": "https://azcafront{token}.{region}.azurecontainerapps.io",
  "AZURE_CONTAINER_REGISTRY_ENDPOINT": "azcr{token}.azurecr.io",
  "AZURE_KEY_VAULT_ENDPOINT": "https://azkv{token}.vault.azure.net/"
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±

```json
{
  "AZURE_POSTGRESQL_HOST": "azpsql{token}.postgres.database.azure.com",
  "AZURE_POSTGRESQL_DATABASE": "techbookstore",
  "AZURE_REDIS_HOST": "azredis{token}.redis.cache.windows.net",
  "AZURE_REDIS_PORT": 6380
}
```

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. **Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰:**
   ```powershell
   docker build -t <registry>/backend:latest ./backend
   docker build -t <registry>/frontend:latest ./frontend
   ```

2. **Container Registry ã«ãƒ—ãƒƒã‚·ãƒ¥:**
   ```powershell
   az acr login --name <registry-name>
   docker push <registry>/backend:latest
   docker push <registry>/frontend:latest
   ```

3. **Container Apps ã®æ›´æ–°:**
   ```powershell
   az containerapp update --name <backend-app> --image <registry>/backend:latest
   az containerapp update --name <frontend-app> --image <registry>/frontend:latest
   ```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–

1. **Key Vault ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ«ã®è¨­å®š**
2. **ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ SSL è¨¼æ˜æ›¸ã®è¿½åŠ **
3. **Private Endpoint ã®æ§‹æˆ** (PostgreSQL, Redis)
4. **Application Gateway ã®è¿½åŠ ** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

### ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®š

1. **Application Insights ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ**
2. **ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«ã®è¨­å®š** (ã‚¨ãƒ©ãƒ¼ç‡ã€å¿œç­”æ™‚é–“)
3. **Log Analytics ã‚¯ã‚¨ãƒªã®ä½œæˆ**
4. **Azure Monitor ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã®è¨­å®š**

## ğŸ’° ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

### æœˆé–“æ¨å®šã‚³ã‚¹ãƒˆ (æ±æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³)

| ãƒªã‚½ãƒ¼ã‚¹ | SKU | æ¨å®šã‚³ã‚¹ãƒˆ (USD/æœˆ) |
|---------|-----|-----------------|
| Container Apps (Backend) | Consumption | $30-50 |
| Container Apps (Frontend) | Consumption | $20-30 |
| PostgreSQL | Standard_D2ds_v5 | $120-150 |
| Redis | Basic C0 | $16 |
| Container Registry | Basic | $5 |
| Key Vault | Standard | $3 |
| Application Insights | Pay-as-you-go | $10-30 |
| Log Analytics | Pay-as-you-go | $5-15 |
| **åˆè¨ˆ** | - | **$209-299** |

**æ³¨:** å®Ÿéš›ã®ã‚³ã‚¹ãƒˆã¯ä½¿ç”¨é‡ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚

### ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®æ¨å¥¨äº‹é …

1. **PostgreSQL SKU ã®å¤‰æ›´:** Standard_D2ds_v5 â†’ Standard_B1ms (ç´„70%å‰Šæ¸›)
2. **Container Apps ã®ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«:** éãƒ”ãƒ¼ã‚¯æ™‚ã« minReplicas=0 ã«è¨­å®š
3. **Log Analytics ã®ä¿å­˜æœŸé–“çŸ­ç¸®:** 30æ—¥ â†’ 7æ—¥
4. **Redis SKU ã®è¦‹ç›´ã—:** Basic C0 ã¯æ—¢ã«æœ€å°

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§

### Container Apps

| ãƒ¡ãƒˆãƒªãƒƒã‚¯ | Backend | Frontend |
|----------|---------|----------|
| CPU | 1.0 vCPU | 0.5 vCPU |
| Memory | 2 GiB | 1 GiB |
| Min Replicas | 1 | 1 |
| Max Replicas | 3 | 2 |
| Target Port | 8080 | 80 |
| Ingress | External | External |
| CORS | Enabled | Enabled |

### Database

| ãƒ¡ãƒˆãƒªãƒƒã‚¯ | å€¤ |
|----------|-----|
| PostgreSQL Version | 17 |
| vCores | 2 |
| Storage | 32 GB (auto-grow enabled) |
| Backup Retention | 7 days |
| High Availability | Disabled (é–‹ç™ºç’°å¢ƒ) |

### Cache

| ãƒ¡ãƒˆãƒªãƒƒã‚¯ | å€¤ |
|----------|-----|
| Redis Version | Latest |
| Memory | 250 MB |
| TLS | Required |
| Port | 6380 (SSL) |

## ğŸ§ª æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ

### Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¤œè¨¼

```powershell
az bicep build --file infra/main.bicep
```

**çµæœ:** âœ… æˆåŠŸ (è­¦å‘Šã®ã¿ã€ã‚¨ãƒ©ãƒ¼ãªã—)

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ¤œè¨¼

```powershell
az deployment group validate `
  --resource-group rg-techbookstore-prod `
  --template-file infra/main.bicep `
  --parameters infra/main.parameters.json
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```powershell
# Backend health
curl https://<backend-url>/actuator/health

# Frontend health
curl https://<frontend-url>/
```

## ğŸ›¡ï¸ ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¨ã‚¬ãƒãƒŠãƒ³ã‚¹

### é©ç”¨æ¸ˆã¿ Azure ãƒãƒªã‚·ãƒ¼

- âœ… Managed Identity ã®ä½¿ç”¨
- âœ… TLS/SSL ã®å¼·åˆ¶
- âœ… ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã®åˆ¶é™ (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)
- âœ… ç›£æŸ»ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–
- âœ… ã‚¿ã‚°ã®é©ç”¨ (ç’°å¢ƒè­˜åˆ¥ç”¨)

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ (Managed Identity)
- âœ… æœ€å°æ¨©é™ã®åŸå‰‡ (RBAC)
- âœ… ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã® Key Vault ç®¡ç†
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… ç›£æŸ»ãƒ­ã‚°ã¨ç›£è¦–

## ğŸ“ ã‚µãƒãƒ¼ãƒˆã¨ãƒªã‚½ãƒ¼ã‚¹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è©³ç´°ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](infra/README.md)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¬ã‚¤ãƒ‰](infra/QUICKSTART.md)
- [ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ](infra/compliance-report.md)

### Azure ãƒªã‚½ãƒ¼ã‚¹

- [Azure Container Apps ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/container-apps/)
- [Azure Database for PostgreSQL ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/postgresql/)
- [Azure Cache for Redis ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/azure-cache-for-redis/)
- [Azure Key Vault ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/key-vault/)

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

1. **ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã—ãŸå ´åˆ:** [README.md](infra/README.md) ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
2. **ãƒªã‚½ãƒ¼ã‚¹ã‚¯ã‚©ãƒ¼ã‚¿ã®å•é¡Œ:** `appmod-get-available-region-sku` ãƒ„ãƒ¼ãƒ«ã§ä»£æ›¿ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèª
3. **æ¥ç¶šã®å•é¡Œ:** Service Connector ã®çŠ¶æ…‹ã‚’ç¢ºèª (`az containerapp connection show`)

## âœ… å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ (main.bicep)
- [x] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ (main.parameters.json)
- [x] ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ (deploy.ps1)
- [x] ãƒã‚¹ãƒˆãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ (post-provision.ps1)
- [x] åŒ…æ‹¬çš„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ (README.md, QUICKSTART.md)
- [x] ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
- [x] IaC ãƒ«ãƒ¼ãƒ«ã®é©ç”¨ (28/28 ãƒ«ãƒ¼ãƒ«)
- [x] Bicep æ¤œè¨¼ (æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãªã—)
- [x] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®å®Ÿè£…
- [x] åˆ©ç”¨å¯èƒ½ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ç¢ºèª (eastus2 é¸æŠ)

## ğŸ‰ çµè«–

TechBookStore ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Azure ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãŒæ­£å¸¸ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚ã™ã¹ã¦ã® IaC ãƒ«ãƒ¼ãƒ«ã«æº–æ‹ ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’å®Ÿè£…ã—ãŸã€æœ¬ç•ªç’°å¢ƒå¯¾å¿œã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå®Œæˆã—ã¾ã—ãŸã€‚

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€`infra/deploy.ps1` ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦å®Ÿéš›ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã€ãã®å¾Œ `infra/post-provision.ps1` ã§ Service Connector æ¥ç¶šã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã™ã€‚

---

**ç”Ÿæˆæ—¥æ™‚:** 2026å¹´2æœˆ9æ—¥  
**ç”Ÿæˆãƒ„ãƒ¼ãƒ«:** GitHub Copilot + Azure MCP Tools  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** âœ… å®Œäº†
